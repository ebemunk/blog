const fs=require('fs'),axios=require('axios'),d3=require('d3'),Chess=require('chess.js').Chess,fangol=JSON.parse(fs.readFileSync('../../content/2016-02-27-visual-look-chess/chess/fangol.json')).openings,openingsFromData=d3.hierarchy(fangol).sum(a=>a.children.length?0:a.count).sort((a,b)=>b.height-a.height||b.value-a.value),allOpenings=[];openingsFromData.each(b=>{const a=new Chess;b.ancestors().reverse().slice(1).forEach(b=>{a.move(b.data.san)});const c=a.fen().split(' ')[0];allOpenings.push(c)});const collectEco=async()=>{const a='abcde'.split('').map(a=>`https://github.com/niklasf/eco/raw/master/${a}.tsv`),b=await Promise.all(a.map(a=>axios.get(a))),c=b.flatMap(({data:a})=>a.split('\n').slice(1).filter(Boolean).map(a=>{const[b,c,d,e]=a.split('	');return{eco:b,name:c,fen:d,moves:e}})),d=allOpenings.map(b=>{const a=c.find(a=>a.fen.split(' ')[0]===b);return a||null}).filter(Boolean),e=d.reduce((b,a)=>({...b,[a.fen.split(' ')[0]]:a.eco+' - '+a.name}),{});fs.writeFileSync('ecos.json',JSON.stringify(e))};collectEco()